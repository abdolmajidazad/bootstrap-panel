'use strict';

myApp.controllerProvider.register('headerController', ['$scope', '$state', '$timeout', '$rootScope', '$location', 'loader', 'appService', 'contextMenuFactory', function ($scope, $state, $timeout, $rootScope, $location, loader, appService, contextMenuFactory) {
    // $rootScope.generalData = {};
    $rootScope.generalData['informationData'] = false;
    $scope.menuOptions = contextMenuFactory;
    $rootScope.generalData['viewType'] = false;
    // $rootScope.generalData['informationData'] = false;


    $scope.filterPanel = function () {
        var itemSelected = $rootScope.generalData['jhoobinJhubDataList'].filter(function (item) {
            return item['name'] === $rootScope.generalData['jhoobinJhubDataSelected'];
        });
        $rootScope.generalData['jhoobinJhubDataRecordSelected'] = itemSelected[0];
        return itemSelected[0]['packageName'];
    };

    $scope.setPanelName = function (data) {
        $rootScope.generalData['jhoobinJhubDataSelected'] = data['name'];
        var option = {
            data: {
                appPackageName: data['packageName']
            }
        };
        appService.appSetter(option).then(function () {
            $("directory-directive").remove();
            $state.reload();
        });
    };

    $rootScope.changeInfoStatus = function () {
        $scope.toggleSide = !$scope.toggleSide;
        closeSide();
        $rootScope.generalData['informationData'] = !$rootScope.generalData['informationData'];
        document.getElementById('left-sidebar-information').style.left = $rootScope.generalData['informationData'] ? 0 : '';
        if (window.innerWidth <= 760) return;
        document.getElementById('main-data-content').style.width = $rootScope.generalData['informationData'] ? 'calc(100% - 320px)' : '';
    };

    $rootScope.changeInfoStatusOtherPage = function () {
        $rootScope.generalData['informationData'] = false;
        $rootScope.$broadcast('contentSelectedInformation', {}, '', 'header');
        // $rootScope.$broadcast('selectedItem', '');
        document.getElementById('left-sidebar-information').style.left = $rootScope.generalData['informationData'] ? 0 : '';
        if (window.innerWidth <= 760) return;
        document.getElementById('main-data-content').style.width = $rootScope.generalData['informationData'] ? 'calc(100% - 320px)' : '';
    };

    $scope.toggleFunc = function (n) {

        $rootScope.generalData['toggleAppListStatus'] = false;
        $scope.toggleSide = !n;
        if ($scope.toggleSide) {
            openSide();
        } else {
            closeSide();
        }

        if (window.innerWidth > 760) return;
        document.getElementById('left-sidebar-information').style.left = '';
        $rootScope.generalData['informationData'] = false;
    };

    document.getElementsByClassName('main-content')[0].addEventListener("click", function () {
        $scope.toggleBox = false;
        closeSide();

        if (window.innerWidth > 760) return;
        document.getElementById('left-sidebar-information').style.left = '';
        $rootScope.generalData['informationData'] = false;
        $rootScope.$apply();
    });

    function openSide() {
        document.getElementsByTagName('html')[0].style.overflowY = 'hidden';
        $scope.toggleSide = true;
        $(".sidebar.right").addClass('sidebar-toggle');
        $(".main-content").css('opacity', 0.9);
    }

    function closeSide() {
        document.getElementsByTagName('html')[0].style.overflowY = 'scroll';
        $scope.toggleSide = false;
        $(".sidebar.right").removeClass('sidebar-toggle');
        $(".main-content").css('opacity', 1);
    }

    $rootScope.setActiveMenu = function (text, url, checkDisabled) {
        closeSide();

        console.log(text, url, checkDisabled);
        if ($state.current['url'] === url) {
            if (checkDisabled && $rootScope.generalData['jhoobinJhubDataSelected']) {
                $state.reload();
            } else if (!checkDisabled) {
                console.log("sashalsihaksjahskajhsa");
                $state.reload();
            }
        }
        $timeout(function () {
            $rootScope.$apply();
        }, 1);
    };

    $scope.signoutFunc = function () {
        $rootScope.generalData['versionFilter'] = {};
        async.auto({
            startLoading: function startLoading(cb) {
                loader.show('html');
                cb(null, true);
            }, signout: ['startLoading', function (cb, result) {
                var options = {
                    data: {}
                };
                appService.signout(options).then(function (resp) {
                    console.log("resp", resp);
                    if (resp.status === 200) {
                        cb(null, resp.data);
                    } else {
                        cb(resp);
                    }
                }).catch(function (error) {
                    cb(error);
                });
            }]
        }, function (errors, result) {
            if (errors) {} else {
                $rootScope.generalData = {};
                $state.go('root.signin');
            }
            loader.hide('html');
        });
    };

    $rootScope.generalData['toggleAppListStatus'] = false;
    $scope.toggleAppList = function () {
        $rootScope.generalData['toggleAppListStatus'] = !$rootScope.generalData['toggleAppListStatus'];
        if (!$rootScope.generalData['toggleAppListStatus']) {
            $scope.$broadcast('exitFilter');
        }
    };

    $scope.toggleProfile = function () {
        $rootScope.generalData['toggleAppListStatus'] = false;
    };

    $scope.$on('contentSelectedInformation', function (n, contentInfo, viewType, state) {
        $scope.selectedItemInformation = contentInfo;
    });

    $scope.move = function () {
        $scope.itemDropDown = $scope.selectedItemInformation['Name'].replace(/^[^a-z]+|[^\w:.-]+/gi, "");
        setTimeout(function () {
            $rootScope.$broadcast('loadMoveFunc', 'header', $scope.itemDropDown);
        }, 500);
    };

    $scope.newFolder = function () {
        $rootScope.$broadcast('newFolderCreatorDirective', { "test": 3 });
    };

    $scope.fileUpload = function () {
        $rootScope.$broadcast("fileUploadDirective");
    };
    $scope.remove = function () {
        $rootScope.$broadcast('removeDirective', $scope.selectedItemInformation);
    };

    $scope.rename = function () {
        $rootScope.$broadcast('renameDirective', $scope.selectedItemInformation);
    };
}]);
